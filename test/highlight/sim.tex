\documentclass[10pt,a4paper]{article}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage{color}
\usepackage{alltt}
\newcommand{\hlstd}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\hlkey}[1]{\textcolor[rgb]{0,0,0}{\bf{#1}}}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.16,0.16,1}{#1}}
\newcommand{\hltyp}[1]{\textcolor[rgb]{0.51,0,0}{#1}}
\newcommand{\hlesc}[1]{\textcolor[rgb]{1,0,1}{#1}}
\newcommand{\hlstr}[1]{\textcolor[rgb]{1,0,0}{#1}}
\newcommand{\hldstr}[1]{\textcolor[rgb]{0.51,0.51,0}{#1}}
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.51,0.51,0.51}{\it{#1}}}
\newcommand{\hldir}[1]{\textcolor[rgb]{0,0.51,0}{#1}}
\newcommand{\hlline}[1]{\textcolor[rgb]{0.33,0.33,0.33}{#1}}
\begin{document}
\definecolor{bgcolor}{rgb}{1,1,1}
\pagecolor{bgcolor}
\noindent
\ttfamily
\hlstd{\\
}\hlline{\ \ \ 1\ }\hlstd{}\hldir{\#include\ $<$gtk/gtk.h$>$\\
}\hlline{\ \ \ 2\ }\hldir{}\hlstd{}\hldir{\#include\ $<$math.h$>$\\
}\hlline{\ \ \ 3\ }\hldir{}\hlstd{}\hldir{\#include\ $<$time.h$>$\\
}\hlline{\ \ \ 4\ }\hldir{}\hlstd{}\hldir{\#include\ $<$gsl/gsl\textunderscore rng.h$>$\\
}\hlline{\ \ \ 5\ }\hldir{}\hlstd{}\hldir{\#include\ $<$gsl/gsl\textunderscore randist.h$>$\\
}\hlline{\ \ \ 6\ }\hldir{}\hlstd{\\
}\hlline{\ \ \ 7\ }\hlstd{}\hldir{\#include\ }\hldstr{"sim.h"}\hldir{\\
}\hlline{\ \ \ 8\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"afield.h"}\hldir{\\
}\hlline{\ \ \ 9\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"graph.h"}\hldir{\\
}\hlline{\ \ 10\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"ui\textunderscore afield.h"}\hldir{\\
}\hlline{\ \ 11\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"ui\textunderscore graph.h"}\hldir{\\
}\hlline{\ \ 12\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"darea.h"}\hldir{\\
}\hlline{\ \ 13\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"status.h"}\hldir{\\
}\hlline{\ \ 14\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"timer.h"}\hldir{\\
}\hlline{\ \ 15\ }\hldir{}\hlstd{}\hldir{\#include\ }\hldstr{"util.h"}\hldir{\\
}\hlline{\ \ 16\ }\hldir{}\hlstd{}\hlcom{/*\\
}\hlline{\ \ 17\ }\hlcom{\#include\ "sound.h"\\
}\hlline{\ \ 18\ }\hlcom{*/}\hlstd{\\
}\hlline{\ \ 19\ }\hlstd{}\hldir{\#if\ HAVE\textunderscore CONFIG\textunderscore H\\
}\hlline{\ \ 20\ }\hldir{}\hlstd{}\hldir{\#include\ $<$config.h$>$\\
}\hlline{\ \ 21\ }\hldir{}\hlstd{}\hldir{\#endif\\
}\hlline{\ \ 22\ }\hldir{}\hlstd{\\
}\hlline{\ \ 23\ }\hlstd{}\hldir{\#include\ }\hldstr{"gettext.h"}\hldir{\\
}\hlline{\ \ 24\ }\hldir{}\hlstd{}\hldir{\#define\ \textunderscore (String)\ gettext\ (String)\\
}\hlline{\ \ 25\ }\hldir{}\hlstd{}\hldir{\#define\ N\textunderscore (String)\ gettext\textunderscore noop\ (String)\\
}\hlline{\ \ 26\ }\hldir{}\hlstd{\\
}\hlline{\ \ 27\ }\hlstd{}\hltyp{static\ void\ }\hlstd{resume\textunderscore sim(GtkWidget\ *button,\ MyTimer\ *timer);\\
}\hlline{\ \ 28\ }\hlstd{}\hltyp{static\ void\ }\hlstd{pause\textunderscore sim(GtkWidget\ *button,\ MyTimer\ *timer);\\
}\hlline{\ \ 29\ }\hlstd{}\hltyp{static\ void\ }\hlstd{stop\textunderscore sim(GtkWidget\ *button,\ gint\ *quit);\\
}\hlline{\ \ 30\ }\hlstd{\\
}\hlline{\ \ 31\ }\hlstd{}\hltyp{static\ }\hlstd{gdouble\ calc\textunderscore duration(gint\ number,\ gdouble\ thalf);\\
}\hlline{\ \ 32\ }\hlstd{}\hltyp{static\ }\hlstd{gdouble\ exp\textunderscore growth(gdouble\ t,\ SimData\ *data);\\
}\hlline{\ \ 33\ }\hlstd{}\hltyp{static\ }\hlstd{gint\ decay\textunderscore real(gdouble\ t,\ gint\ n,\ gdouble\ thalf,\ gsl\textunderscore rng\ *rand);\\
}\hlline{\ \ 34\ }\hlstd{\\
}\hlline{\ \ 35\ }\hlstd{}\hltyp{static\ }\hlstd{gint\ decay\textunderscore stat(gdouble\ t,\ gint\ n,\ gint\ n0,\ gdouble\ thalf);\\
}\hlline{\ \ 36\ }\hlstd{\\
}\hlline{\ \ 37\ }\hlstd{}\hltyp{void\ }\hlstd{sim\textunderscore decay(GtkWidget\ *button\textunderscore start,\ gsl\textunderscore rng\ *rand)\\
}\hlline{\ \ 38\ }\hlstd{\{\\
}\hlline{\ \ 39\ }\hlstd{\hlstd{\hskip 8 mm}GtkWidget\ *top,\ **darea,\ *button\textunderscore stop,\\
}\hlline{\ \ 40\ }\hlstd{\hlstd{\hskip 28 mm}*spin\textunderscore number,\ **spin\textunderscore htime,\\
}\hlline{\ \ 41\ }\hlstd{\hlstd{\hskip 28 mm}**label\textunderscore atom,\ *label\textunderscore time;\\
}\hlline{\ \ 42\ }\hlstd{\hlstd{\hskip 8 mm}gdouble\ t,\ thalf,\ tstart,\ tnext,\ told,\ tstep,\ tloop;\\
}\hlline{\ \ 43\ }\hlstd{\\
}\hlline{\ \ 44\ }\hlstd{\hlstd{\hskip 8 mm}CoordSystem\ *coord;\\
}\hlline{\ \ 45\ }\hlstd{\hlstd{\hskip 8 mm}Graph\ **graph;\\
}\hlline{\ \ 46\ }\hlstd{\hlstd{\hskip 8 mm}Point\ *point,\ *old\textunderscore point;\\
}\hlline{\ \ 47\ }\hlstd{\\
}\hlline{\ \ 48\ }\hlstd{\hlstd{\hskip 8 mm}MyTimer\ *timer;\\
}\hlline{\ \ 49\ }\hlstd{\hlstd{\hskip 8 mm}gint\ quit;\\
}\hlline{\ \ 50\ }\hlstd{\hlstd{\hskip 8 mm}gint\ number,\ pos,\ state,\ decays,\ i,\ a,\ b;\\
}\hlline{\ \ 51\ }\hlstd{\hlstd{\hskip 8 mm}AtomField\ *afield;\\
}\hlline{\ \ 52\ }\hlstd{\\
}\hlline{\ \ 53\ }\hlstd{\hlstd{\hskip 8 mm}gulong\ *sig\textunderscore darea[N\textunderscore DAREAS];\\
}\hlline{\ \ 54\ }\hlstd{\\
}\hlline{\ \ 55\ }\hlstd{\hlstd{\hskip 8 mm}SimData\ *sdata;\\
}\hlline{\ \ 56\ }\hlstd{\hlstd{\hskip 8 mm}GraphFunc\ *gf;\\
}\hlline{\ \ 57\ }\hlstd{\\
}\hlline{\ \ 58\ }\hlstd{\hlstd{\hskip 8 mm}top\ =\ gtk\textunderscore widget\textunderscore get\textunderscore toplevel(button\textunderscore start);\\
}\hlline{\ \ 59\ }\hlstd{\\
}\hlline{\ \ 60\ }\hlstd{\hlstd{\hskip 8 mm}}\hlcom{/*\ holt\ ein\ paar\ gespeicherte\ Widgets\ \"a\"o\"u\ */}\hlstd{\\
}\hlline{\ \ 61\ }\hlstd{\hlstd{\hskip 8 mm}button\textunderscore stop\ =\ g\textunderscore object\textunderscore get\textunderscore data(G\textunderscore OBJECT(top),\ }\hlstr{"button\textunderscore stop"}\hlstd{);\\
}\hlline{\ \ 62\ }\hlstd{\hlstd{\hskip 8 mm}spin\textunderscore number\ =\ g\textunderscore object\textunderscore get\textunderscore data(G\textunderscore OBJECT(top),\ }\hlstr{"spin\textunderscore number"}\hlstd{);\\
}\hlline{\ \ 63\ }\hlstd{\hlstd{\hskip 8 mm}spin\textunderscore htime\ =\ g\textunderscore object\textunderscore get\textunderscore data(G\textunderscore OBJECT(top),\ }\hlstr{"spin\textunderscore htime"}\hlstd{);\\
}\hlline{\ \ 64\ }\hlstd{\hlstd{\hskip 8 mm}darea\ =\ g\textunderscore object\textunderscore get\textunderscore data(G\textunderscore OBJECT(top),\ }\hlstr{"darea"}\hlstd{);\\
}\hlline{\ \ 65\ }\hlstd{\hlstd{\hskip 8 mm}label\textunderscore atom\ =\ g\textunderscore object\textunderscore get\textunderscore data(G\textunderscore OBJECT(top),\ }\hlstr{"label\textunderscore atom"}\hlstd{);\\
}\hlline{\ \ 66\ }\hlstd{\hlstd{\hskip 8 mm}label\textunderscore time\ =\ g\textunderscore object\textunderscore get\textunderscore data(G\textunderscore OBJECT(top),\ }\hlstr{"label\textunderscore time"}\hlstd{);\\
}\hlline{\ \ 67\ }\hlstd{\\
}\hlline{\ \ 68\ }\hlstd{\hlstd{\hskip 8 mm}}\hlcom{/*\ ersetzt\ den\ Startbutton\ durch\ den\ Pausebutton\ */}\hlstd{\\
}\hlline{\ \ 69\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handlers\textunderscore block\textunderscore by\textunderscore func(G\textunderscore OBJECT(button\textunderscore start),\\
}\hlline{\ \ 70\ }\hlstd{\hlstd{\hskip 72 mm}(gpointer)\ sim\textunderscore decay,\ rand);\\
}\hlline{\ \ 71\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore button\textunderscore set\textunderscore label(GTK\textunderscore BUTTON(button\textunderscore start),\ \textunderscore (}\hlstr{"pause"}\hlstd{));\\
}\hlline{\ \ 72\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore button\textunderscore leave(GTK\textunderscore BUTTON(button\textunderscore start));\\
}\hlline{\ \ 73\ }\hlstd{\\
}\hlline{\ \ 74\ }\hlstd{\hlstd{\hskip 8 mm}}\hlcom{/*\ bereitet\ den\ Stopbutton\ vor\ â‚¬\ */}\hlstd{\\
}\hlline{\ \ 75\ }\hlstd{\hlstd{\hskip 8 mm}quit\ =\ }\hlnum{0}\hlstd{;\\
}\hlline{\ \ 76\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore widget\textunderscore set\textunderscore sensitive(button\textunderscore stop,\ TRUE);\\
}\hlline{\ \ 77\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore connect(G\textunderscore OBJECT(button\textunderscore stop),\ }\hlstr{"clicked"}\hlstd{,\\
}\hlline{\ \ 78\ }\hlstd{\hlstd{\hskip 42 mm}G\textunderscore CALLBACK(stop\textunderscore sim),\ \&quit);\\
}\hlline{\ \ 79\ }\hlstd{\\
}\hlline{\ \ 80\ }\hlstd{\hlstd{\hskip 8 mm}}\hlcom{/*\ holt\ die\ Eingaben\ des\ Nutzers\ von\ den\ Spinbutton\ */}\hlstd{\\
}\hlline{\ \ 81\ }\hlstd{\hlstd{\hskip 8 mm}number\ =\ gtk\textunderscore spin\textunderscore button\textunderscore get\textunderscore value\textunderscore as\textunderscore int(GTK\textunderscore SPIN\textunderscore BUTTON(spin\textunderscore number))\\
}\hlline{\ \ 82\ }\hlstd{\hlstd{\hskip 26 mm};\\
}\hlline{\ \ 83\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{for\ }\hlstd{(i\ =\ }\hlnum{0}\hlstd{;\ i\ $<$\ ATOM\textunderscore STATES}\hlnum{-1}\hlstd{;\ i++)\\
}\hlline{\ \ 84\ }\hlstd{\hlstd{\hskip 16 mm}thalf[i]\ =\ gtk\textunderscore spin\textunderscore button\textunderscore get\textunderscore value(GTK\textunderscore SPIN\textunderscore BUTTON(spin\textunderscore htime[i])\\
}\hlline{\ \ 85\ }\hlstd{\hlstd{\hskip 38 mm});\\
}\hlline{\ \ 86\ }\hlstd{\\
}\hlline{\ \ 87\ }\hlstd{\hlstd{\hskip 8 mm}}\hlcom{/*\ packt\ die\ Eingaben\ in\ die\ SimData\ Struktur\ */}\hlstd{\\
}\hlline{\ \ 88\ }\hlstd{\hlstd{\hskip 8 mm}sdata\ =\ (SimData\ *)\ g\textunderscore malloc(}\hlkey{sizeof}\hlstd{(SimData));\\
}\hlline{\ \ 89\ }\hlstd{\hlstd{\hskip 8 mm}sdata-$>$atoms[}\hlnum{0}\hlstd{]\ =\ number;\\
}\hlline{\ \ 90\ }\hlstd{\hlstd{\hskip 8 mm}sdata-$>$states\ =\ }\hlnum{3}\hlstd{;\\
}\hlline{\ \ 91\ }\hlstd{\hlstd{\hskip 8 mm}sdata-$>$atoms[}\hlnum{1}\hlstd{]\ =\ }\hlnum{0}\hlstd{;\\
}\hlline{\ \ 92\ }\hlstd{\hlstd{\hskip 8 mm}sdata-$>$atoms[}\hlnum{2}\hlstd{]\ =\ }\hlnum{0}\hlstd{;\\
}\hlline{\ \ 93\ }\hlstd{\hlstd{\hskip 8 mm}sdata-$>$thalf[}\hlnum{0}\hlstd{]\ =\ thalf[}\hlnum{0}\hlstd{];\\
}\hlline{\ \ 94\ }\hlstd{\hlstd{\hskip 8 mm}sdata-$>$thalf[}\hlnum{1}\hlstd{]\ =\ thalf[}\hlnum{1}\hlstd{];\\
}\hlline{\ \ 95\ }\hlstd{\\
}\hlline{\ \ 96\ }\hlstd{\hlstd{\hskip 8 mm}gf\ =\ (GraphFunc\ *)\ g\textunderscore malloc(}\hlkey{sizeof}\hlstd{(GraphFunc));\\
}\hlline{\ \ 97\ }\hlstd{\hlstd{\hskip 8 mm}gf-$>$func\ =\ exp\textunderscore growth;\\
}\hlline{\ \ 98\ }\hlstd{\hlstd{\hskip 8 mm}gf-$>$data\ =\ sdata;\\
}\hlline{\ \ 99\ }\hlstd{\\
}\hlline{\ 100\ }\hlstd{\hlstd{\hskip 8 mm}afield\ =\ afield\textunderscore new(number,\ (darea\ +\ }\hlnum{1}\hlstd{)-$>$allocation.width,\\
}\hlline{\ 101\ }\hlstd{\hlstd{\hskip 26 mm}(darea\ +\ }\hlnum{1}\hlstd{)-$>$allocation.height);\\
}\hlline{\ 102\ }\hlstd{\hlstd{\hskip 8 mm}afield\textunderscore randomize(afield,\ rand);\\
}\hlline{\ 103\ }\hlstd{\\
}\hlline{\ 104\ }\hlstd{\hlstd{\hskip 8 mm}sig\textunderscore darea[}\hlnum{0}\hlstd{]\ =\ g\textunderscore signal\textunderscore connect(G\textunderscore OBJECT(darea[}\hlnum{0}\hlstd{]),\\
}\hlline{\ 105\ }\hlstd{\hlstd{\hskip 8 mm}}\hlstr{"configure\textunderscore event"}\hlstd{,\ G\textunderscore CALLBACK(afield\textunderscore resize),\ afield);\\
}\hlline{\ 106\ }\hlstd{\\
}\hlline{\ 107\ }\hlstd{\hlstd{\hskip 8 mm}tstep\ =\ }\hlnum{0.003}\hlstd{;\\
}\hlline{\ 108\ }\hlstd{\hlstd{\hskip 8 mm}pos\ =\ }\hlnum{0}\hlstd{;\\
}\hlline{\ 109\ }\hlstd{\\
}\hlline{\ 110\ }\hlstd{\hlstd{\hskip 8 mm}update\textunderscore status\textunderscore atoms(darea[}\hlnum{0}\hlstd{],\ sdata-$>$atoms);\\
}\hlline{\ 111\ }\hlstd{\hlstd{\hskip 8 mm}update\textunderscore status\textunderscore time(darea[}\hlnum{0}\hlstd{],\ }\hlnum{0.0}\hlstd{);\\
}\hlline{\ 112\ }\hlstd{\hlstd{\hskip 8 mm}darea\textunderscore clear(darea[}\hlnum{0}\hlstd{]);\\
}\hlline{\ 113\ }\hlstd{\hlstd{\hskip 8 mm}afield\textunderscore draw(darea[}\hlnum{0}\hlstd{],\ afield);\\
}\hlline{\ 114\ }\hlstd{\\
}\hlline{\ 115\ }\hlstd{\hlstd{\hskip 8 mm}gdk\textunderscore window\textunderscore get\textunderscore size((darea\ +\ }\hlnum{1}\hlstd{)-$>$window,\ \&a,\ \&b);\\
}\hlline{\ 116\ }\hlstd{\hlstd{\hskip 8 mm}coord\ =\ coord\textunderscore system\textunderscore new((darea\ +\ }\hlnum{1}\hlstd{)-$>$allocation.width,\\
}\hlline{\ 117\ }\hlstd{\hlstd{\hskip 58 mm}(darea\ +\ }\hlnum{1}\hlstd{)-$>$allocation.height,\\
}\hlline{\ 118\ }\hlstd{\hlstd{\hskip 58 mm}}\hlnum{0}\hlstd{,\ calc\textunderscore duration(number,\ thalf),\\
}\hlline{\ 119\ }\hlstd{\hlstd{\hskip 58 mm}}\hlnum{0}\hlstd{,\ number);\\
}\hlline{\ 120\ }\hlstd{\\
}\hlline{\ 121\ }\hlstd{\hlstd{\hskip 8 mm}darea\textunderscore clear(darea[}\hlnum{1}\hlstd{]);\\
}\hlline{\ 122\ }\hlstd{\hlstd{\hskip 8 mm}coord\textunderscore system\textunderscore draw(darea[}\hlnum{1}\hlstd{],\ coord);\\
}\hlline{\ 123\ }\hlstd{\\
}\hlline{\ 124\ }\hlstd{\hlstd{\hskip 8 mm}graph\textunderscore draw\textunderscore func(graph\textunderscore func,\ darea[}\hlnum{1}\hlstd{],\ coord);\\
}\hlline{\ 125\ }\hlstd{\\
}\hlline{\ 126\ }\hlstd{\hlstd{\hskip 8 mm}graph\ =\ g\textunderscore malloc(}\hlnum{2\ }\hlstd{*\ }\hlkey{sizeof}\hlstd{(Graph\ *));\\
}\hlline{\ 127\ }\hlstd{\hlstd{\hskip 8 mm}graph[}\hlnum{0}\hlstd{]\ =\ graph\textunderscore new(}\hlnum{0}\hlstd{);\\
}\hlline{\ 128\ }\hlstd{\hlstd{\hskip 8 mm}coord-$>$graphs\ =\ graph;\\
}\hlline{\ 129\ }\hlstd{\\
}\hlline{\ 130\ }\hlstd{\hlstd{\hskip 8 mm}sig\textunderscore darea[}\hlnum{1}\hlstd{]\ =\ g\textunderscore signal\textunderscore connect(G\textunderscore OBJECT(darea[}\hlnum{1}\hlstd{]),\ }\hlstr{"configure\textunderscore event"}\hlstd{,\\
}\hlline{\ 131\ }\hlstd{\hlstd{\hskip 72 mm}G\textunderscore CALLBACK(graph\textunderscore resize),\ coord);\\
}\hlline{\ 132\ }\hlstd{\\
}\hlline{\ 133\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{while\ }\hlstd{(g\textunderscore main\textunderscore iteration(FALSE));\\
}\hlline{\ 134\ }\hlstd{\\
}\hlline{\ 135\ }\hlstd{\hlstd{\hskip 8 mm}timer\ =\ timer\textunderscore new();\\
}\hlline{\ 136\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore connect(G\textunderscore OBJECT(button),\ }\hlstr{"clicked"}\hlstd{,\\
}\hlline{\ 137\ }\hlstd{\hlstd{\hskip 42 mm}G\textunderscore CALLBACK(pause\textunderscore sim),\ timer);\\
}\hlline{\ 138\ }\hlstd{\hlstd{\hskip 8 mm}tstart\ =\ tnext\ =\ told\ =\ timer\textunderscore elapsed(timer);\\
}\hlline{\ 139\ }\hlstd{\\
}\hlline{\ 140\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{while}\hlstd{(sdata-$>$atoms[}\hlnum{0}\hlstd{]\ $>$\ }\hlnum{0\ }\hlstd{\&\&\ (!quit))\ \{\\
}\hlline{\ 141\ }\hlstd{\hlstd{\hskip 16 mm}t\ =\ timer\textunderscore elapsed(timer)\ -\ tstart;\\
}\hlline{\ 142\ }\hlstd{\hlstd{\hskip 16 mm}}\hlkey{if\ }\hlstd{(t\ $>$=\ tnext)\ \{\\
}\hlline{\ 143\ }\hlstd{\hlstd{\hskip 24 mm}tloop\ =\ t\ -\ told;\\
}\hlline{\ 144\ }\hlstd{\hlstd{\hskip 24 mm}told\ =\ t;\\
}\hlline{\ 145\ }\hlstd{\hlstd{\hskip 24 mm}}\hlkey{for\ }\hlstd{(state\ =\ }\hlnum{0}\hlstd{;\ state\ $<$\ sdata-$>$states\ }\hlnum{-\ 1}\hlstd{;\ state++)\ \{\\
}\hlline{\ 146\ }\hlstd{\hlstd{\hskip 32 mm}decays\ =\ decay\textunderscore real(tloop,\ sdata-$>$atoms[state],\ thalf,\\
}\hlline{\ 147\ }\hlstd{\hlstd{\hskip 50 mm}rand);\\
}\hlline{\ 148\ }\hlstd{\hlstd{\hskip 32 mm}}\hlkey{if\ }\hlstd{(decays\ $>$\ }\hlnum{0}\hlstd{)\ \{\\
}\hlline{\ 149\ }\hlstd{\hlstd{\hskip 40 mm}sdata-$>$atoms[state\ +\ }\hlnum{0}\hlstd{]\ -=\ decays;\\
}\hlline{\ 150\ }\hlstd{\hlstd{\hskip 40 mm}sdata-$>$atoms[state\ +\ }\hlnum{1}\hlstd{]\ +=\ decays;\\
}\hlline{\ 151\ }\hlstd{\\
}\hlline{\ 152\ }\hlstd{\hlstd{\hskip 40 mm}update\textunderscore status\textunderscore atoms(darea[}\hlnum{0}\hlstd{],\ sdata-$>$atoms);\\
}\hlline{\ 153\ }\hlstd{\\
}\hlline{\ 154\ }\hlstd{\hlstd{\hskip 40 mm}}\hlkey{for\ }\hlstd{(i\ =\ }\hlnum{0}\hlstd{;\ i\ $<$\ decays;\ i++)\ \{\\
}\hlline{\ 155\ }\hlstd{\hlstd{\hskip 48 mm}(af-$>$coords\ +\ pos)-$>$state\ =\ }\hlnum{1}\hlstd{;\\
}\hlline{\ 156\ }\hlstd{\hlstd{\hskip 48 mm}draw\textunderscore atom(darea[}\hlnum{0}\hlstd{],\\
}\hlline{\ 157\ }\hlstd{\hlstd{\hskip 68 mm}(afield-$>$coords\ +\ pos),\\
}\hlline{\ 158\ }\hlstd{\hlstd{\hskip 68 mm}afield-$>$wide);\\
}\hlline{\ 159\ }\hlstd{\hlstd{\hskip 48 mm}pos++;\\
}\hlline{\ 160\ }\hlstd{\hlstd{\hskip 40 mm}\}\\
}\hlline{\ 161\ }\hlstd{\hlstd{\hskip 32 mm}\}\\
}\hlline{\ 162\ }\hlstd{\\
}\hlline{\ 163\ }\hlstd{\hlstd{\hskip 32 mm}point\ =\ point\textunderscore alloc(t,\ sdata-$>$atoms[}\hlnum{0}\hlstd{]);\\
}\hlline{\ 164\ }\hlstd{\hlstd{\hskip 32 mm}}\hlkey{if\ }\hlstd{(graph-$>$points\ !=\ NULL)\ \{\\
}\hlline{\ 165\ }\hlstd{\hlstd{\hskip 40 mm}old\textunderscore point\ =\ graph-$>$points-$>$data;\\
}\hlline{\ 166\ }\hlstd{\hlstd{\hskip 40 mm}graph\textunderscore draw\textunderscore line(darea[}\hlnum{1}\hlstd{],\ coord,\\
}\hlline{\ 167\ }\hlstd{\hlstd{\hskip 72 mm}old\textunderscore point-$>$x,\ old\textunderscore point-$>$y,\\
}\hlline{\ 168\ }\hlstd{\hlstd{\hskip 72 mm}point-$>$x,\ point-$>$y,\ }\hlnum{0}\hlstd{);\\
}\hlline{\ 169\ }\hlstd{\hlstd{\hskip 32 mm}\}\\
}\hlline{\ 170\ }\hlstd{\hlstd{\hskip 32 mm}graph\textunderscore add(graph,\ point);\\
}\hlline{\ 171\ }\hlstd{\hlstd{\hskip 24 mm}\}\\
}\hlline{\ 172\ }\hlstd{\\
}\hlline{\ 173\ }\hlstd{\hlstd{\hskip 24 mm}tnext\ +=\ tstep;\\
}\hlline{\ 174\ }\hlstd{\hlstd{\hskip 16 mm}\}\\
}\hlline{\ 175\ }\hlstd{\hlstd{\hskip 16 mm}update\textunderscore status\textunderscore time(darea[}\hlnum{0}\hlstd{],\ t);\\
}\hlline{\ 176\ }\hlstd{\\
}\hlline{\ 177\ }\hlstd{\hlstd{\hskip 16 mm}}\hlkey{while\ }\hlstd{(gtk\textunderscore events\textunderscore pending())\\
}\hlline{\ 178\ }\hlstd{\hlstd{\hskip 24 mm}gtk\textunderscore main\textunderscore iteration();\\
}\hlline{\ 179\ }\hlstd{}\hlcom{/*\hlstd{\hskip 16 mm}while\ (g\textunderscore main\textunderscore iteration(FALSE));\ */}\hlstd{\\
}\hlline{\ 180\ }\hlstd{\hlstd{\hskip 8 mm}\}\\
}\hlline{\ 181\ }\hlstd{\\
}\hlline{\ 182\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handlers\textunderscore disconnect\textunderscore matched(G\textunderscore OBJECT(button\textunderscore stop),\\
}\hlline{\ 183\ }\hlstd{\hlstd{\hskip 82 mm}G\textunderscore SIGNAL\textunderscore MATCH\textunderscore FUNC,\\
}\hlline{\ 184\ }\hlstd{\hlstd{\hskip 82 mm}}\hlnum{0}\hlstd{,\\
}\hlline{\ 185\ }\hlstd{\hlstd{\hskip 82 mm}}\hlnum{0}\hlstd{,\\
}\hlline{\ 186\ }\hlstd{\hlstd{\hskip 82 mm}NULL,\\
}\hlline{\ 187\ }\hlstd{\hlstd{\hskip 82 mm}(gpointer)\ stop\textunderscore sim,\\
}\hlline{\ 188\ }\hlstd{\hlstd{\hskip 82 mm}NULL);\\
}\hlline{\ 189\ }\hlstd{\\
}\hlline{\ 190\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore widget\textunderscore set\textunderscore sensitive(button\textunderscore stop,\ FALSE);\\
}\hlline{\ 191\ }\hlstd{\\
}\hlline{\ 192\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{if\ }\hlstd{(timer\textunderscore is\textunderscore running(timer))\\
}\hlline{\ 193\ }\hlstd{\hlstd{\hskip 16 mm}g\textunderscore signal\textunderscore handlers\textunderscore disconnect\textunderscore matched(G\textunderscore OBJECT(button\textunderscore start),\\
}\hlline{\ 194\ }\hlstd{\hlstd{\hskip 90 mm}G\textunderscore SIGNAL\textunderscore MATCH\textunderscore FUNC,\\
}\hlline{\ 195\ }\hlstd{\hlstd{\hskip 90 mm}}\hlnum{0}\hlstd{,\ }\hlnum{0}\hlstd{,\ NULL,\\
}\hlline{\ 196\ }\hlstd{\hlstd{\hskip 90 mm}(gpointer)\ pause\textunderscore sim,\\
}\hlline{\ 197\ }\hlstd{\hlstd{\hskip 90 mm}NULL);\\
}\hlline{\ 198\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{else\\
}\hlline{\ 199\ }\hlkey{\hlstd{\hskip 16 mm}}\hlstd{g\textunderscore signal\textunderscore handlers\textunderscore disconnect\textunderscore matched(G\textunderscore OBJECT(button\textunderscore start),\\
}\hlline{\ 200\ }\hlstd{\hlstd{\hskip 32 mm}G\textunderscore SIGNAL\textunderscore MATCH\textunderscore FUNC,\ }\hlnum{0}\hlstd{,\ }\hlnum{0}\hlstd{,\ NULL,\ (gpointer)\ resume\textunderscore sim,\\
}\hlline{\ 201\ }\hlstd{\hlstd{\hskip 100 mm}NULL);\\
}\hlline{\ 202\ }\hlstd{\\
}\hlline{\ 203\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handlers\textunderscore unblock\textunderscore by\textunderscore func(G\textunderscore OBJECT(button\textunderscore start),\\
}\hlline{\ 204\ }\hlstd{\hlstd{\hskip 76 mm}(gpointer)\ sim\textunderscore decay,\ rand);\\
}\hlline{\ 205\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore button\textunderscore set\textunderscore label(GTK\textunderscore BUTTON(button\textunderscore start),\ \textunderscore (}\hlstr{"start"}\hlstd{));\\
}\hlline{\ 206\ }\hlstd{\\
}\hlline{\ 207\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handler\textunderscore disconnect(G\textunderscore OBJECT(darea[}\hlnum{0}\hlstd{]),\ sig\textunderscore darea[}\hlnum{0}\hlstd{]);\\
}\hlline{\ 208\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handler\textunderscore disconnect(G\textunderscore OBJECT(darea[}\hlnum{1}\hlstd{]),\ sig\textunderscore darea[}\hlnum{1}\hlstd{]);\\
}\hlline{\ 209\ }\hlstd{\\
}\hlline{\ 210\ }\hlstd{\hlstd{\hskip 8 mm}timer\textunderscore free(timer);\\
}\hlline{\ 211\ }\hlstd{\\
}\hlline{\ 212\ }\hlstd{\hlstd{\hskip 8 mm}afield\textunderscore free(afield);\\
}\hlline{\ 213\ }\hlstd{\\
}\hlline{\ 214\ }\hlstd{\hlstd{\hskip 8 mm}coord\textunderscore system\textunderscore free(coord);\\
}\hlline{\ 215\ }\hlstd{\}\\
}\hlline{\ 216\ }\hlstd{\\
}\hlline{\ 217\ }\hlstd{}\hltyp{static\ void\ }\hlstd{resume\textunderscore sim(GtkWidget\ *button,\ MyTimer\ *timer)\\
}\hlline{\ 218\ }\hlstd{\{\\
}\hlline{\ 219\ }\hlstd{\hlstd{\hskip 8 mm}timer\textunderscore start(timer);\\
}\hlline{\ 220\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handlers\textunderscore disconnect\textunderscore by\textunderscore func(G\textunderscore OBJECT(button),\\
}\hlline{\ 221\ }\hlstd{\hlstd{\hskip 8 mm}(gpointer)\ resume\textunderscore sim,\ timer);\\
}\hlline{\ 222\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore connect(G\textunderscore OBJECT(button),\ }\hlstr{"clicked"}\hlstd{,\\
}\hlline{\ 223\ }\hlstd{\hlstd{\hskip 42 mm}G\textunderscore CALLBACK(pause\textunderscore sim),\ timer);\\
}\hlline{\ 224\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore button\textunderscore set\textunderscore label(GTK\textunderscore BUTTON(button),\ \textunderscore (}\hlstr{"pause"}\hlstd{));\\
}\hlline{\ 225\ }\hlstd{\}\\
}\hlline{\ 226\ }\hlstd{\\
}\hlline{\ 227\ }\hlstd{}\hltyp{static\ void\ }\hlstd{pause\textunderscore sim(GtkWidget\ *button,\ MyTimer\ *timer)\\
}\hlline{\ 228\ }\hlstd{\{\\
}\hlline{\ 229\ }\hlstd{\hlstd{\hskip 8 mm}timer\textunderscore stop(timer);\\
}\hlline{\ 230\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore handlers\textunderscore disconnect\textunderscore by\textunderscore func(G\textunderscore OBJECT(button),\\
}\hlline{\ 231\ }\hlstd{\hlstd{\hskip 24 mm}(gpointer)\ pause\textunderscore sim,\ timer);\\
}\hlline{\ 232\ }\hlstd{\hlstd{\hskip 8 mm}g\textunderscore signal\textunderscore connect(G\textunderscore OBJECT(button),\ }\hlstr{"clicked"}\hlstd{,\\
}\hlline{\ 233\ }\hlstd{\hlstd{\hskip 42 mm}G\textunderscore CALLBACK(resume\textunderscore sim),\ timer);\\
}\hlline{\ 234\ }\hlstd{\hlstd{\hskip 8 mm}gtk\textunderscore button\textunderscore set\textunderscore label(GTK\textunderscore BUTTON(button),\ \textunderscore (}\hlstr{"resume"}\hlstd{));\\
}\hlline{\ 235\ }\hlstd{\}\\
}\hlline{\ 236\ }\hlstd{\\
}\hlline{\ 237\ }\hlstd{}\hltyp{static\ void\ }\hlstd{stop\textunderscore sim(GtkWidget\ *button,\ gint\ *quit)\\
}\hlline{\ 238\ }\hlstd{\{\\
}\hlline{\ 239\ }\hlstd{\hlstd{\hskip 8 mm}*quit\ =\ }\hlnum{1}\hlstd{;\\
}\hlline{\ 240\ }\hlstd{\}\\
}\hlline{\ 241\ }\hlstd{\\
}\hlline{\ 242\ }\hlstd{}\hltyp{static\ }\hlstd{gdouble\ calc\textunderscore duration(gint\ number,\ gdouble\ thalf)\\
}\hlline{\ 243\ }\hlstd{\{\\
}\hlline{\ 244\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{return\ }\hlstd{-thalf\ *\ log2(}\hlnum{1.0\ }\hlstd{/\ number)\ +\ thalf;\\
}\hlline{\ 245\ }\hlstd{\}\\
}\hlline{\ 246\ }\hlstd{\\
}\hlline{\ 247\ }\hlstd{}\hltyp{static\ }\hlstd{gdouble\ exp\textunderscore growth(gdouble\ t,\ SimData\ *data)\\
}\hlline{\ 248\ }\hlstd{\{\\
}\hlline{\ 249\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{return\ }\hlstd{(gint)\ (data-$>$atoms[}\hlnum{0}\hlstd{]\ *\ pow(}\hlnum{0.5}\hlstd{,\ (t\ /\ data-$>$thalf[}\hlnum{0}\hlstd{]))\ +\ }\hlnum{0.5}\hlstd{);\\
}\hlline{\ 250\ }\hlstd{\}\\
}\hlline{\ 251\ }\hlstd{\\
}\hlline{\ 252\ }\hlstd{}\hltyp{static\ }\hlstd{gint\ decay\textunderscore stat(gdouble\ t,\ gint\ n,\ gint\ n0,\ gdouble\ thalf)\\
}\hlline{\ 253\ }\hlstd{\{\\
}\hlline{\ 254\ }\hlstd{\hlstd{\hskip 8 mm}}\hlkey{return\ }\hlstd{n\ -\ (gint)\ ((n0\ *\ pow(}\hlnum{0.5}\hlstd{,\ t\ /\ thalf))\ +\ }\hlnum{0.5}\hlstd{);\\
}\hlline{\ 255\ }\hlstd{\}\\
}\hlline{\ 256\ }\hlstd{\\
}\hlline{\ 257\ }\hlstd{}\hltyp{static\ }\hlstd{gint\ decay\textunderscore real(gdouble\ t,\ gint\ n,\ gdouble\ thalf,\ gsl\textunderscore rng\ *rand)\\
}\hlline{\ 258\ }\hlstd{\{\\
}\hlline{\ 259\ }\hlstd{}\hlcom{/*\hlstd{\hskip 6 mm}return\ (gsl\textunderscore ran\textunderscore binomial(rand,\ (1.0\ -\ pow(0.5,\ (t\ /\ thalf))),\ n));\ */}\hlstd{\\
}\hlline{\ 260\ }\hlstd{\hlstd{\hskip 6 mm}}\hlkey{return\ }\hlstd{gsl\textunderscore ran\textunderscore poisson(rand,\ ((}\hlnum{1.0\ }\hlstd{-\ pow(}\hlnum{0.5}\hlstd{,\ (t\ /\ thalf))))\ *\ n);\\
}\hlline{\ 261\ }\hlstd{\}}\mbox{}\\
\normalfont

\end {document}
(* LaTeX generated by highlight 2.0-16, http://www.andre-simon.de/ *)
